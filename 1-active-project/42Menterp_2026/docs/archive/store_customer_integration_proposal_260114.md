# 매장-고객 데이터 관리 고도화 제안 (Store-Customer Integration Proposal)

**작성일:** 2026-01-14
**작성자:** Antigravity Agent

---

## 1. 문제 정의 (Problem Statement)

### 1.1 현재 상황
- "매장(Store)"과 "고객(Customer)" 데이터 간의 경계가 모호함.
- 두 엔티티 모두 `사업자번호`, `대표자`, `연락처`, `주소` 등의 필드를 중복으로 가지고 있음.
- 사용자는 매장 등록 시 고객 정보를 다시 입력해야 하는 번거로움을 겪으며, 데이터 불일치(Data Inconsistency) 위험이 존재함.

### 1.2 핵심 구분 (Concept Definition)
데이터의 역할을 명확히 분리하여 혼선을 줄여야 합니다.

| 엔티티 | 역할 | 비유 (E-Commerce) | 주요 관리 항목 |
|--------|------|-------------------|----------------|
| **고객 (Customer)** | **계약 및 정산 주체** (Bill-To Party) | 주문자 (Buyer) | 세금계산서 정보, 계약 기간, 정산 이메일 |
| **매장 (Store)** | **서비스 제공 대상** (Service Location) | 배송지 (Shipping Addr) | MID, 플레이스 URL, 키워드, 작업 로그 |

---

## 2. 해결 방안 (Solution)

### 2.1 데이터 입력 플로우 개선 (UX Flow)

#### A. 매장 등록 시 "고객 정보 불러오기"
매장 등록 화면에서 고객사를 선택하면, 고객사의 사업자 정보를 자동으로 가져와 채워주는 기능을 제공합니다.

1. **고객사 선택**: 드롭다운 or 검색으로 고객사 선택.
2. **정보 동기화 토글**: `[체크] 고객사 사업자 정보 사용`
3. **자동 완성**: 사업자번호, 대표자, 주소, 이메일 등이 고객 정보로 자동 채워짐.
4. **개별 수정**: 필요한 경우(지점별 사업자가 다른 경우) 개별 수정 가능.

#### B. 고객 상세에서 매장 관리
고객 상세 페이지 내에서 **'연결된 매장 관리'** 기능을 강화합니다.

- **일괄 업데이트**: 고객사의 사업자 번호가 변경된 경우, 연결된 모든 매장의 정보를 한 번에 업데이트하는 버튼 제공.
- **매장 추가**: 고객 상세 페이지에서 바로 해당 고객 소속의 매장을 추가하는 `+ 매장 추가` 버튼 배치 (고객ID 자동 바인딩).

### 2.2 화면 구성 제안

#### 매장 목록 (Store List)
매장 목록에서 **'소속 고객사'**를 명확히 표시하여 관계를 시각화합니다.

```
[매장명] 강남맛집      [고객사] (주)맛있는세상
MID: 12345678         담당: 홍길동 (010-1234-5678)
```

#### 고객 목록 (Customer List)
고객 목록에서 **'운영 매장 수'**와 **'주요 매장명'**을 노출합니다.

```
[고객사] (주)맛있는세상  [매장] 3개 운영 중
사업자: 123-45-67890    (강남맛집, 홍대맛집 외 1)
```

### 2.3 기술적 동기화 전략 (Sync Strategy)

#### A. '상속' 개념 도입 (UI 레벨)
DB 스키마를 당장 변경(필드 삭제)하는 것은 위험하므로, UI 레벨에서 **상속(Inheritance)** 개념을 도입합니다.

- **Store 조회 시:** `Store.businessNo`가 비어있으면 `Store.customer.businessNo`를 보여주는 로직 적용 (Fallback).
- **Store 저장 시:** 명시적으로 입력된 값만 저장.

#### B. 동기화 로직 (Backend)
- 고객 정보 수정 API (`PUT /api/customers/:id`) 호출 시, `syncStores: true` 옵션을 받으면 연결된 모든 매장의 정보를 덮어쓰기 하는 로직 구현.

---

## 3. 실행 계획 (Action Plan)

### Phase 1: 가시성 확보 (Visibility)
1. **매장 목록/상세:** 고객사 정보 노출 강화. 고객사 바로가기 링크 추가.
2. **고객 목록/상세:** 연결된 매장 리스트 UI 개선 (`CUSTOMERS_ENHANCEMENT.md` 참조).

### Phase 2: 입력 편의성 (Convenience)
1. **매장 등록/수정 폼 개선:**
    - 고객사 선택 시 정보 자동 채우기(Auto-fill) 스크립트 적용.
    - "고객 정보와 동일" 체크박스 추가.

### Phase 3: 데이터 정합성 (Consistency)
1. **일괄 동기화 기능:** 고객 정보 수정 시 하위 매장 동기화 기능 구현.
2. **데이터 클렌징:** 기존 데이터 중 불일치하는 건을 찾아 매핑해주는 스크립트 실행.

---

## 4. 결론

"매장"과 "고객"은 **1:N 관계**의 명확한 계층 구조를 가집니다. 이를 섞어서 생각하지 않고, **'고객(돈)'이 '매장(일)'을 소유한다**는 개념으로 UI를 정리하면 혼란을 줄일 수 있습니다.

**제안:** 우선 **Phase 1 & 2 (UI 개선 및 자동완성)** 부터 적용하면 사용자의 혼란을 즉시 80% 이상 줄일 수 있습니다.
