# 03. 고객 셀프서비스 주문 포털 설계

> 고객이 직접 웹에서 견적 요청/주문을 할 수 있는 공개 페이지 설계

## 1. 개요

### 1.1 목적
- 고객이 전화/카톡 없이 직접 주문 가능
- 24시간 접수 가능 (영업시간 외 주문 확보)
- 반복 문의 응대 시간 절감
- 정확한 고객 정보 수집 (오타, 누락 방지)

### 1.2 핵심 기능
| 기능 | 설명 |
|------|------|
| 제품 카탈로그 | 광고 상품 목록 및 가격 안내 |
| 견적 요청 | 상품 선택 후 견적서 요청 |
| 바로 주문 | 가격 확인 후 즉시 주문 |
| 고객 정보 입력 | 연락처, 매장 정보 수집 |
| 주문 확인 | 접수 완료 알림 |

---

## 2. 사용자 플로우

```
[랜딩] → [상품 선택] → [고객 정보 입력] → [주문 확인] → [완료]
```

### 2.1 단계별 상세

#### Step 1: 랜딩 페이지
```
┌─────────────────────────────────────────────┐
│  🏪 네이버 플레이스 마케팅 전문              │
│                                             │
│  "매장 노출, 저희가 책임집니다"              │
│                                             │
│  ┌─────────────┐  ┌─────────────┐          │
│  │ 견적 요청   │  │ 바로 주문   │          │
│  └─────────────┘  └─────────────┘          │
│                                             │
│  📞 상담 필요시: 010-XXXX-XXXX              │
└─────────────────────────────────────────────┘
```

#### Step 2: 상품 선택
```
┌─────────────────────────────────────────────┐
│  상품 선택                          Step 1/3│
├─────────────────────────────────────────────┤
│                                             │
│  [트래픽 상품]                              │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐   │
│  │ 트래픽   │ │ 트래픽   │ │ 트래픽   │   │
│  │ 30타    │ │ 50타    │ │ 100타   │   │
│  │ 33,000원│ │ 55,000원│ │ 100,000원│   │
│  │  [선택] │ │  [선택] │ │  [선택] │   │
│  └──────────┘ └──────────┘ └──────────┘   │
│                                             │
│  [저장 상품]                                │
│  ┌──────────┐ ┌──────────┐                 │
│  │ 저장     │ │ 저장     │                 │
│  │ 50건    │ │ 100건   │                 │
│  │ 55,000원│ │ 100,000원│                 │
│  │  [선택] │ │  [선택] │                 │
│  └──────────┘ └──────────┘                 │
│                                             │
├─────────────────────────────────────────────┤
│  선택한 상품: 트래픽 30타 x 1               │
│  예상 금액: 33,000원                        │
│                                             │
│                          [다음 단계 →]      │
└─────────────────────────────────────────────┘
```

#### Step 3: 고객 정보 입력
```
┌─────────────────────────────────────────────┐
│  고객 정보                          Step 2/3│
├─────────────────────────────────────────────┤
│                                             │
│  [담당자 정보]                              │
│  이름 *        [                    ]       │
│  연락처 *      [                    ]       │
│  이메일        [                    ]       │
│                                             │
│  [매장 정보]                                │
│  매장명 *      [                    ]       │
│  매장 주소     [                    ]       │
│  네이버플레이스 URL                         │
│               [                    ]       │
│               (선택, 진단 시 활용)          │
│                                             │
│  [요청사항]                                 │
│  ┌─────────────────────────────────┐       │
│  │                                 │       │
│  │                                 │       │
│  └─────────────────────────────────┘       │
│                                             │
│            [← 이전]    [다음 단계 →]        │
└─────────────────────────────────────────────┘
```

#### Step 4: 주문 확인
```
┌─────────────────────────────────────────────┐
│  주문 확인                          Step 3/3│
├─────────────────────────────────────────────┤
│                                             │
│  [주문 내역]                                │
│  ┌─────────────────────────────────────┐   │
│  │ 트래픽 30타        1개    33,000원  │   │
│  ├─────────────────────────────────────┤   │
│  │ 합계                      33,000원  │   │
│  │ VAT 포함                  36,300원  │   │
│  └─────────────────────────────────────┘   │
│                                             │
│  [고객 정보]                                │
│  담당자: 홍길동                             │
│  연락처: 010-1234-5678                      │
│  매장명: 길동이네 치킨                       │
│                                             │
│  ☐ 개인정보 수집 및 이용에 동의합니다       │
│                                             │
│  ┌──────────────┐  ┌──────────────┐        │
│  │  견적 요청   │  │  바로 주문   │        │
│  └──────────────┘  └──────────────┘        │
└─────────────────────────────────────────────┘
```

#### Step 5: 완료
```
┌─────────────────────────────────────────────┐
│                                             │
│            ✅ 접수 완료!                     │
│                                             │
│  견적번호: Q20260105-001                    │
│                                             │
│  빠른 시일 내에 연락드리겠습니다.            │
│  (영업시간: 평일 09:00 ~ 18:00)             │
│                                             │
│  ┌─────────────────────────────────────┐   │
│  │ 카카오톡 문의: @42ment              │   │
│  │ 전화 문의: 010-XXXX-XXXX            │   │
│  └─────────────────────────────────────┘   │
│                                             │
│              [홈으로 돌아가기]               │
└─────────────────────────────────────────────┘
```

---

## 3. 기술 설계

### 3.1 라우트 구조
```
/order                    # 메인 주문 페이지 (SPA)
  - step=products         # 상품 선택
  - step=info             # 고객 정보
  - step=confirm          # 확인
  - step=complete         # 완료

/api/public/products      # 공개 상품 목록 API
/api/public/orders        # 공개 주문 생성 API
```

### 3.2 컴포넌트 구조
```
app/order/
├── page.tsx              # 메인 컨테이너 (스텝 관리)
├── components/
│   ├── OrderHeader.tsx   # 진행률 표시
│   ├── ProductStep.tsx   # 상품 선택 스텝
│   ├── InfoStep.tsx      # 고객 정보 스텝
│   ├── ConfirmStep.tsx   # 확인 스텝
│   └── CompleteStep.tsx  # 완료 스텝
└── hooks/
    └── useOrderForm.ts   # 폼 상태 관리
```

### 3.3 데이터 모델

#### 주문 요청 Payload
```typescript
interface PublicOrderRequest {
  // 고객 정보
  customerName: string;      // 필수
  customerPhone: string;     // 필수
  customerEmail?: string;
  companyName?: string;
  
  // 매장 정보
  storeName: string;         // 필수
  storeAddress?: string;
  storePhone?: string;
  naverPlaceUrl?: string;
  
  // 주문 항목
  items: {
    productId?: number;
    productName: string;
    quantity: number;
    unitPrice: number;
    notes?: string;
  }[];
  
  // 기타
  requestType: 'quotation' | 'order';
  notes?: string;
}
```

#### 응답
```typescript
interface PublicOrderResponse {
  success: boolean;
  data?: {
    type: 'quotation' | 'order';
    id: number;
    number: string;        // Q20260105-001 or ORD20260105-001
    totalAmount: number;
  };
  message?: string;
  error?: { message: string };
}
```

### 3.4 API 상세

#### GET /api/public/products
공개 상품 목록 조회 (인증 불필요)

**Response:**
```json
{
  "success": true,
  "data": {
    "products": [...],
    "groupedProducts": {
      "트래픽": [...],
      "저장": [...],
      "리뷰": [...]
    },
    "categories": ["트래픽", "저장", "리뷰"]
  }
}
```

#### POST /api/public/orders
주문/견적 요청 생성

**Request:** `PublicOrderRequest`
**Response:** `PublicOrderResponse`

**처리 로직:**
1. 고객 정보로 기존 고객 검색 (전화번호 기준)
2. 없으면 새 고객 생성
3. 매장 정보로 기존 매장 검색
4. 없으면 새 매장 생성
5. requestType에 따라 견적서 또는 주문 생성
6. 생성된 번호와 함께 응답

---

## 4. UI/UX 설계

### 4.1 디자인 원칙
- **심플**: 최소한의 입력 필드
- **신뢰감**: 전문적인 디자인
- **모바일 우선**: 대부분 모바일에서 접속
- **빠른 완료**: 3단계 이내 완료

### 4.2 색상 팔레트
```css
:root {
  --primary: #00C73C;      /* 네이버 그린 */
  --primary-dark: #00A032;
  --secondary: #1A1A1A;
  --background: #FAFAFA;
  --card: #FFFFFF;
  --border: #E5E5E5;
  --text: #333333;
  --text-muted: #888888;
  --success: #00C73C;
  --error: #FF3B30;
}
```

### 4.3 반응형 브레이크포인트
```css
/* 모바일 (기본) */
@media (min-width: 640px) { /* sm: 태블릿 */ }
@media (min-width: 1024px) { /* lg: 데스크톱 */ }
```

### 4.4 상품 카드 디자인
```
┌────────────────────┐
│   [아이콘/이미지]   │
│                    │
│   트래픽 30타      │
│   하루 30타 유입   │
│                    │
│   33,000원/일      │
│                    │
│  ┌──────────────┐  │
│  │    선택      │  │
│  └──────────────┘  │
└────────────────────┘

선택시:
┌────────────────────┐
│ ✓ [아이콘/이미지]  │  ← 체크 표시
│                    │
│   트래픽 30타      │
│   하루 30타 유입   │
│                    │
│   33,000원/일      │
│                    │
│  수량: [−] 1 [+]   │  ← 수량 조절
└────────────────────┘
```

---

## 5. 보안 고려사항

### 5.1 Rate Limiting
```typescript
// 동일 IP에서 분당 10회 제한
const rateLimit = {
  windowMs: 60 * 1000,  // 1분
  max: 10,
};
```

### 5.2 입력 검증
- 전화번호 형식 검증 (한국 번호)
- 이메일 형식 검증
- XSS 방지 (입력값 이스케이프)
- SQL Injection 방지 (Prisma ORM)

### 5.3 스팸 방지
- 허니팟 필드 추가 (봇 감지)
- reCAPTCHA v3 (선택적)
- 중복 제출 방지 (쿨다운)

---

## 6. 확장 기능 (Phase 2)

### 6.1 알림 연동
- 주문 접수 시 관리자 카카오톡 알림
- 고객에게 접수 확인 문자 발송
- 이메일 견적서 자동 발송

### 6.2 결제 연동
- 토스페이먼츠 / 아임포트 연동
- 선결제 옵션 추가
- 정기 결제 (구독형 상품)

### 6.3 고객 포털
- 고객 로그인 (전화번호 인증)
- 내 주문 내역 조회
- 진행 상황 확인
- 재주문 기능

---

## 7. 구현 우선순위

### MVP (1-2일)
1. ✅ 공개 상품 API
2. ✅ 공개 주문 API  
3. ⬜ 3단계 주문 폼 UI
4. ⬜ 완료 페이지

### Phase 1 (3-5일)
5. ⬜ 반응형 디자인 최적화
6. ⬜ Rate Limiting
7. ⬜ 관리자 알림 (카카오톡)

### Phase 2 (1-2주)
8. ⬜ 고객 문자 알림
9. ⬜ 결제 연동
10. ⬜ 고객 포털

---

## 8. 참고: 기존 API와의 연계

```
공개 주문 (/api/public/orders)
    ↓
자동으로 Customer, Store 생성/연결
    ↓
Quotation 또는 Order 생성
    ↓
기존 관리자 화면에서 확인 가능
  - /quotations (견적 목록)
  - /orders (주문 목록)
```

**태그**: 웹에서 생성된 주문/견적은 `[웹 주문]`, `[웹 견적요청]` 태그로 구분

---

*문서 작성: 2026-01-05*
*버전: 1.0*

