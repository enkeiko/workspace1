# Feature Specification: 42ment ERP v0.1

**Feature Branch**: `002-42ment-erp`
**Created**: 2025-11-11
**Status**: Draft
**Input**: User description: "42ment ERP v0.1 - 프리랜서를 위한 프로젝트 관리 시스템으로 고객 관리, 프로젝트 일정 추적, 작업 시간 기록, 자동 청구서 발행"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 고객 정보 관리 (Priority: P1)

프리랜서는 고객(클라이언트)의 기본 정보를 등록하고 조회할 수 있어야 합니다. 고객명, 연락처, 이메일, 주소 등의 정보를 저장하고 필요할 때 검색하여 확인할 수 있습니다.

**Why this priority**: 모든 프로젝트와 청구서는 고객과 연결되므로, 고객 관리는 시스템의 기초가 됩니다. 이 기능 없이는 다른 기능들을 사용할 수 없습니다.

**Independent Test**: 고객을 추가하고, 목록에서 조회하고, 상세 정보를 확인할 수 있으면 독립적으로 테스트 완료입니다.

**Acceptance Scenarios**:

1. **Given** 사용자가 로그인한 상태에서, **When** 고객 추가 화면에서 고객명, 연락처, 이메일을 입력하고 저장하면, **Then** 고객 목록에 새 고객이 표시됩니다
2. **Given** 여러 고객이 등록된 상태에서, **When** 고객명으로 검색하면, **Then** 일치하는 고객 목록이 표시됩니다
3. **Given** 고객 목록이 표시된 상태에서, **When** 특정 고객을 선택하면, **Then** 해당 고객의 상세 정보가 표시됩니다
4. **Given** 고객 상세 화면에서, **When** 정보를 수정하고 저장하면, **Then** 변경된 정보가 목록과 상세 화면에 반영됩니다

---

### User Story 2 - 프로젝트 생성 및 일정 관리 (Priority: P2)

프리랜서는 고객별로 프로젝트를 생성하고, 프로젝트명, 시작일, 마감일, 상태(진행중/완료/보류)를 관리할 수 있어야 합니다. 프로젝트 목록을 조회하고 상태별로 필터링할 수 있습니다.

**Why this priority**: 고객 정보가 있어야 프로젝트를 생성할 수 있지만, 프로젝트 관리는 프리랜서의 핵심 업무입니다. 작업 시간 기록과 청구서 발행의 기반이 됩니다.

**Independent Test**: 기존 고객에 대해 프로젝트를 생성하고, 일정을 설정하고, 상태를 변경하고, 목록에서 필터링할 수 있으면 독립적으로 테스트 완료입니다.

**Acceptance Scenarios**:

1. **Given** 고객이 등록된 상태에서, **When** 프로젝트 생성 화면에서 고객 선택, 프로젝트명, 시작일, 마감일을 입력하고 저장하면, **Then** 프로젝트 목록에 새 프로젝트가 표시됩니다
2. **Given** 여러 프로젝트가 생성된 상태에서, **When** 상태 필터를 "진행중"으로 선택하면, **Then** 진행중인 프로젝트만 표시됩니다
3. **Given** 프로젝트 목록에서, **When** 특정 프로젝트를 선택하여 상태를 "완료"로 변경하면, **Then** 해당 프로젝트가 완료 목록으로 이동합니다
4. **Given** 프로젝트 상세 화면에서, **When** 마감일을 연장하고 저장하면, **Then** 변경된 마감일이 프로젝트 정보에 반영됩니다

---

### User Story 3 - 작업 시간 기록 (Priority: P3)

프리랜서는 각 프로젝트에 대해 작업한 시간을 기록할 수 있어야 합니다. 날짜, 작업 시간(시작-종료 또는 총 시간), 작업 내용을 입력하고, 프로젝트별로 누적 작업 시간을 조회할 수 있습니다.

**Why this priority**: 작업 시간은 청구서 발행의 기초 데이터이지만, 프로젝트가 먼저 생성되어야 하므로 P3입니다. 시간 기록 없이도 고정 금액으로 청구서를 발행할 수 있습니다.

**Independent Test**: 기존 프로젝트에 대해 작업 시간을 등록하고, 프로젝트별 총 작업 시간을 조회할 수 있으면 독립적으로 테스트 완료입니다.

**Acceptance Scenarios**:

1. **Given** 프로젝트가 생성된 상태에서, **When** 작업 시간 추가 화면에서 날짜, 시작 시간, 종료 시간, 작업 내용을 입력하고 저장하면, **Then** 해당 프로젝트의 작업 시간 목록에 표시됩니다
2. **Given** 프로젝트에 여러 작업 시간이 기록된 상태에서, **When** 프로젝트 상세 화면을 열면, **Then** 총 작업 시간이 자동으로 계산되어 표시됩니다
3. **Given** 작업 시간 목록에서, **When** 특정 작업 시간을 선택하여 수정하면, **Then** 변경된 시간이 반영되고 총 작업 시간이 재계산됩니다
4. **Given** 여러 날짜에 작업 시간이 기록된 상태에서, **When** 날짜 범위로 필터링하면, **Then** 해당 기간의 작업 시간만 표시되고 합계가 계산됩니다

---

### User Story 4 - 자동 청구서 생성 (Priority: P4)

프리랜서는 프로젝트 정보와 작업 시간을 기반으로 청구서를 자동으로 생성할 수 있어야 합니다. 고객 정보, 프로젝트명, 작업 내역, 시간당 요금, 총 금액이 포함된 청구서를 생성하고 출력(PDF 또는 인쇄) 가능해야 합니다.

**Why this priority**: 청구서는 모든 이전 단계(고객, 프로젝트, 작업 시간)의 데이터를 활용하므로 가장 마지막 우선순위입니다. 하지만 비즈니스 가치는 매우 높습니다.

**Independent Test**: 작업 시간이 기록된 프로젝트에 대해 청구서를 생성하고, 생성된 청구서에 올바른 정보(고객명, 총 금액 등)가 포함되어 있으면 독립적으로 테스트 완료입니다.

**Acceptance Scenarios**:

1. **Given** 프로젝트에 작업 시간이 기록된 상태에서, **When** "청구서 생성" 버튼을 클릭하고 시간당 요금을 입력하면, **Then** 고객 정보, 프로젝트명, 작업 내역, 총 금액이 포함된 청구서가 생성됩니다
2. **Given** 청구서가 생성된 상태에서, **When** "PDF 저장" 버튼을 클릭하면, **Then** 청구서가 PDF 파일로 다운로드됩니다
3. **Given** 고정 금액 프로젝트인 경우, **When** "청구서 생성" 화면에서 고정 금액을 직접 입력하면, **Then** 작업 시간과 무관하게 입력한 금액으로 청구서가 생성됩니다
4. **Given** 여러 청구서가 생성된 상태에서, **When** 청구서 목록을 조회하면, **Then** 날짜순으로 정렬된 청구서 목록이 표시됩니다

---

### Edge Cases

- **데이터 검증**: 고객명이나 프로젝트명이 비어있을 때 어떻게 처리하나요? → 필수 입력 항목 검증 및 오류 메시지 표시
- **중복 데이터**: 동일한 고객명이 중복 입력되었을 때 경고를 표시하나요? → 경고 메시지 표시하지만 저장은 허용 (동명이인 가능)
- **날짜 유효성**: 프로젝트 시작일이 마감일보다 늦은 경우는? → 입력 시 검증하여 오류 메시지 표시
- **작업 시간 중복**: 같은 시간대에 여러 프로젝트의 작업 시간을 기록하면? → 경고 표시하지만 저장은 허용 (동시 작업 가능)
- **청구서 수정**: 이미 생성된 청구서를 수정할 수 있나요? → 생성 후에는 조회만 가능, 재생성 필요 시 새로 생성
- **데이터 삭제**: 고객을 삭제할 때 관련 프로젝트가 있으면? → 연관된 프로젝트가 있으면 삭제 불가, 경고 메시지 표시
- **대용량 데이터**: 작업 시간 기록이 수백 개일 때 성능은? → 페이지네이션 또는 날짜 범위 필터 제공

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 시스템은 고객 정보(고객명, 연락처, 이메일, 주소)를 등록, 수정, 조회, 삭제할 수 있어야 합니다
- **FR-002**: 시스템은 고객명 또는 연락처로 고객을 검색할 수 있어야 합니다
- **FR-003**: 시스템은 프로젝트 정보(프로젝트명, 시작일, 마감일, 상태, 연결된 고객)를 등록, 수정, 조회할 수 있어야 합니다
- **FR-004**: 시스템은 프로젝트 상태를 "진행중", "완료", "보류" 중 하나로 설정할 수 있어야 합니다
- **FR-005**: 시스템은 프로젝트별로 작업 시간(날짜, 시작 시간, 종료 시간, 작업 내용)을 기록할 수 있어야 합니다
- **FR-006**: 시스템은 프로젝트별 총 작업 시간을 자동으로 계산하여 표시해야 합니다
- **FR-007**: 시스템은 프로젝트와 작업 시간 정보를 기반으로 청구서를 자동 생성할 수 있어야 합니다
- **FR-008**: 청구서에는 고객 정보, 프로젝트명, 작업 내역, 시간당 요금 또는 고정 금액, 총 금액이 포함되어야 합니다
- **FR-009**: 시스템은 생성된 청구서를 PDF 파일로 저장할 수 있어야 합니다
- **FR-010**: 시스템은 필수 입력 항목(고객명, 프로젝트명)이 비어있을 때 오류 메시지를 표시해야 합니다
- **FR-011**: 시스템은 프로젝트 시작일이 마감일보다 늦은 경우 입력을 거부하고 오류 메시지를 표시해야 합니다
- **FR-012**: 시스템은 연관된 프로젝트가 있는 고객을 삭제할 수 없으며, 경고 메시지를 표시해야 합니다
- **FR-013**: 시스템은 단일 사용자를 위한 간단한 비밀번호 인증 기능(로컬 저장)을 제공해야 합니다
- **FR-014**: 시스템은 모든 데이터 변경(생성, 수정, 삭제)에 대해 Adjustment 테이블에 이력을 자동 기록해야 합니다
- **FR-015**: 시스템은 각 엔티티의 전체 변경 이력(History Chain)을 조회할 수 있어야 합니다
- **FR-016**: 시스템은 CSV, JSON 형식으로 데이터를 내보내기(export)할 수 있어야 합니다
- **FR-017**: 시스템은 CSV, JSON 형식에서 데이터를 가져오기(import)할 수 있어야 하며, 스키마 검증을 수행해야 합니다
- **FR-018**: 시스템은 자동 계산 실패 시 수동 입력 모드(`manual_mode=True`)로 전환되어야 하며, 항상 수동으로 데이터를 입력/수정할 수 있어야 합니다

### Key Entities

각 엔티티는 다음 **공통 필드**를 포함해야 합니다:
- `id`: 고유 식별자
- `created_at`: 생성 시각
- `updated_at`: 최종 수정 시각
- `created_by`: 생성자 (단일 사용자이므로 "user"로 고정 가능)
- `manual_edit`: 수동 편집 여부 (Y/N)
- `source`: 데이터 출처 (manual/import/api)
- `notes`: 비고

---

- **고객 (Client)**: 프리랜서가 작업하는 클라이언트를 나타냅니다.
  - **고유 속성**: 고객명, 연락처, 이메일, 주소
  - **공통 속성**: id, created_at, updated_at, created_by, manual_edit, source, notes
  - **관계**: 여러 프로젝트와 연결됩니다 (1:N)
  - **참조 방식**: Project 테이블에서 `client_id`로 참조

- **프로젝트 (Project)**: 특정 고객을 위한 작업 프로젝트를 나타냅니다.
  - **고유 속성**: 프로젝트명, 시작일, 마감일, 상태(진행중/완료/보류), client_id
  - **공통 속성**: id, created_at, updated_at, created_by, manual_edit, source, notes
  - **관계**: 하나의 고객과 연결(N:1), 여러 작업 시간 기록과 연결(1:N)
  - **참조 방식**: `client_id`로 Client 참조, TimeEntry에서 `project_id`로 참조됨

- **작업 시간 (TimeEntry)**: 프로젝트에 투입된 작업 시간을 나타냅니다.
  - **고유 속성**: 날짜, 시작 시간, 종료 시간, 작업 내용, project_id
  - **공통 속성**: id, created_at, updated_at, created_by, manual_edit, source, notes
  - **관계**: 하나의 프로젝트와 연결(N:1)
  - **참조 방식**: `project_id`로 Project 참조

- **청구서 (Invoice)**: 프로젝트에 대한 청구서를 나타냅니다.
  - **고유 속성**: 청구서 번호, 생성일, project_id, 고객 정보 스냅샷, 작업 내역 목록, subtotal(공급가), vat(부가세), total(합계), vat_included(Y/N)
  - **공통 속성**: id, created_at, updated_at, created_by, manual_edit, source, notes
  - **관계**: 하나의 프로젝트와 연결(N:1)
  - **참조 방식**: `project_id`로 Project 참조
  - **불변성**: 청구서는 생성 후 수정 불가 (새로 생성해야 함)

- **조정 기록 (Adjustment)**: 수동 수정 이력을 추적합니다.
  - **고유 속성**: ref_type(엔티티 타입), ref_id(대상 ID), field_name(수정된 필드), old_value(이전 값), new_value(새 값), reason(수정 사유), adjusted_by(수정자)
  - **공통 속성**: id, created_at, notes
  - **목적**: 모든 데이터 변경의 투명성 확보 및 감사 추적

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 사용자는 새로운 고객을 30초 이내에 등록할 수 있습니다
- **SC-002**: 사용자는 기존 고객을 검색하여 5초 이내에 찾을 수 있습니다
- **SC-003**: 사용자는 프로젝트 생성부터 첫 작업 시간 기록까지 2분 이내에 완료할 수 있습니다
- **SC-004**: 시스템은 작업 시간이 100개 이상인 프로젝트에서도 총 시간을 1초 이내에 계산하여 표시합니다
- **SC-005**: 사용자는 청구서를 생성하여 PDF로 저장하는 과정을 1분 이내에 완료할 수 있습니다
- **SC-006**: 생성된 청구서는 수동으로 작성할 때보다 80% 이상의 시간을 절약합니다
- **SC-007**: 시스템은 10개 이상의 활성 프로젝트와 50명 이상의 고객 정보를 지연 없이 관리할 수 있습니다
- **SC-008**: 사용자의 90%는 튜토리얼 없이 고객 등록과 프로젝트 생성을 성공적으로 완료할 수 있습니다

## Assumptions

- **A-001**: 초기 버전은 단일 사용자(프리랜서 본인)만 사용한다고 가정합니다. 향후 팀 협업 기능이 필요할 수 있습니다.
- **A-002**: 시간당 요금은 프로젝트마다 다를 수 있으며, 청구서 생성 시점에 사용자가 입력한다고 가정합니다.
- **A-003**: 청구서는 한번 생성되면 수정 불가능하며, 재생성이 필요한 경우 새로 생성한다고 가정합니다.
- **A-004**: 데이터는 로컬 환경에 저장되며, 초기에는 클라우드 동기화나 백업 기능이 없다고 가정합니다.
- **A-005**: PDF 생성 기능은 기본적인 포맷(텍스트 기반)으로 제공되며, 고급 디자인 커스터마이징은 지원하지 않습니다.
- **A-006**: 작업 시간은 시간 단위로 기록되며, 분 단위 정밀도를 가집니다.
- **A-007**: 프로젝트는 한 명의 고객에게만 연결되며, 여러 고객이 참여하는 프로젝트는 지원하지 않습니다.
- **A-008**: 시스템은 "구조화된 통제력 확보"를 목적으로 하며, 단순 자동화보다 데이터 투명성과 추적 가능성을 우선합니다.
- **A-009**: 모든 핵심 로직은 시스템 내부에서 동작하며, 외부 SaaS(구글 시트, 노션 등)는 단순 export/import 용도로만 사용합니다.
- **A-010**: 데이터 구조는 변경 가능하지만, 모든 스키마 변경은 버전 관리되며 마이그레이션 스크립트를 제공합니다.
- **A-011**: 시스템은 항상 부분적으로 작동 가능해야 하며, 일부 기능 장애가 전체 시스템을 중단시키지 않습니다.
- **A-012**: 모든 데이터 변경은 "근거"를 가지며, 변경 이력은 절대 삭제되지 않습니다 (immutable audit log).

## Dependencies

- **D-001**: PDF 생성 기능은 외부 라이브러리 또는 서비스를 사용할 수 있습니다 (구현 단계에서 결정)
- **D-002**: place-crawler 프로젝트와의 선택적 연동이 가능하도록 설계되어야 하지만, 필수 의존성은 아닙니다
- **D-003**: 데이터 저장소는 구현 단계에서 결정되며(로컬 DB, SQLite, JSON 파일 등), 스펙에서는 기술 스택을 명시하지 않습니다

## Development Principles

이 시스템은 다음 개발 원칙을 따릅니다:

### 1. 직접성 (Direct Control)
- 외부 SaaS 의존 금지: 모든 핵심 로직은 내부 코드에서 동작
- I/O 포트: CSV, JSON 형식만 허용
- 데이터 주권: 사용자가 언제든 데이터를 내보내고 가져올 수 있음

### 2. 투명성 (Traceability)
- 모든 데이터 변경은 Adjustment 테이블에 기록
- 각 데이터의 생성→수정→삭제 전체 이력 추적 가능
- 변경 근거는 절대 삭제되지 않음 (immutable audit log)

### 3. 일관성 (Consistency over Convenience)
- 모든 엔티티는 공통 필드 규약 준수
- 스키마 변경은 버전 관리 및 마이그레이션 스크립트 제공
- 편의보다 구조적 일관성 우선

### 4. 단일 진실의 원천 (Single Source of Truth)
- Client, Project, TimeEntry, Invoice, Adjustment가 핵심 엔티티
- 모든 계산과 리포트는 이 엔티티들을 기반으로 생성
- 중복 데이터 저장 금지

### 5. Fail-safe 구조
- 자동화 실패 시 항상 수동 입력 경로 제공
- 시스템은 절대 완전히 정지하지 않음
- 부분 장애가 전체를 중단시키지 않음

### 6. 사람 우선 (Human-First)
- AI는 제안만 하고, 사람이 최종 결정
- 수동 수정이 항상 자동 계산보다 우선
- 모든 자동화는 중단 가능

## Out of Scope

- 다중 사용자 지원 및 권한 관리
- 클라우드 동기화 및 모바일 앱
- 고급 리포팅 및 분석 대시보드 (매출 추이, 프로젝트 수익성 분석 등)
- 이메일 자동 발송 기능
- 결제 처리 및 결제 상태 추적
- 반복 청구서(정기 청구) 기능
- 다국어 지원
- 세금 계산 및 부가가치세 처리
- AI 기반 자동화 및 제안 기능 (v0.1에서는 제외, 향후 확장 가능)
