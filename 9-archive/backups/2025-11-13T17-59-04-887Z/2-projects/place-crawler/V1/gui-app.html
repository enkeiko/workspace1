<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë„¤ì´ë²„ í”Œë ˆì´ìŠ¤ ìˆ˜ì§‘ê¸°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Malgun Gothic', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 800px;
            width: 100%;
            padding: 40px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 32px;
            color: #333;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 16px;
        }

        .input-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .input-wrapper {
            display: flex;
            gap: 10px;
        }

        input[type="text"], textarea {
            flex: 1;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
        }

        input[type="text"]:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 120px;
            font-family: 'Consolas', monospace;
        }

        .button {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .button-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .button-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .button-secondary {
            background: #f0f0f0;
            color: #333;
        }

        .button-secondary:hover {
            background: #e0e0e0;
        }

        .button-success {
            background: #10b981;
            color: white;
        }

        .button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .id-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .id-chip {
            background: #667eea;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            animation: slideIn 0.3s;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .id-chip button {
            background: rgba(255,255,255,0.3);
            border: none;
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .id-chip button:hover {
            background: rgba(255,255,255,0.5);
        }

        .actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .status {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            display: none;
        }

        .status.active {
            display: block;
        }

        .status-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .log {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Consolas', monospace;
            font-size: 13px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .results {
            margin-top: 20px;
        }

        .result-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }

        .result-title {
            font-size: 20px;
            font-weight: 600;
            color: #333;
        }

        .result-badge {
            background: #10b981;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
        }

        .result-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .info-item {
            display: flex;
            gap: 8px;
            color: #666;
            font-size: 14px;
        }

        .info-label {
            font-weight: 600;
        }

        .help-text {
            font-size: 13px;
            color: #666;
            margin-top: 8px;
        }

        .example-link {
            color: #667eea;
            text-decoration: none;
            font-weight: 500;
        }

        .example-link:hover {
            text-decoration: underline;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab {
            padding: 12px 24px;
            background: none;
            border: none;
            font-size: 15px;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ½ï¸ ë„¤ì´ë²„ í”Œë ˆì´ìŠ¤ ìˆ˜ì§‘ê¸°</h1>
            <p>í”Œë ˆì´ìŠ¤ IDë¥¼ ì…ë ¥í•˜ë©´ ìë™ìœ¼ë¡œ ì •ë³´ë¥¼ ìˆ˜ì§‘í•©ë‹ˆë‹¤</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('single')">ë‹¨ì¼ ìˆ˜ì§‘</button>
            <button class="tab" onclick="switchTab('batch')">ë°°ì¹˜ ìˆ˜ì§‘</button>
            <button class="tab" onclick="switchTab('l1')">L1 ë°ì´í„° ìˆ˜ì§‘</button>
            <button class="tab" onclick="switchTab('logs')">ë””ë²„ê·¸ ë¡œê·¸</button>
        </div>

        <div id="single-tab" class="tab-content active">
            <div class="input-section">
                <div class="form-group">
                    <label for="placeId">í”Œë ˆì´ìŠ¤ ID ì…ë ¥</label>
                    <div class="input-wrapper">
                        <input
                            type="text"
                            id="placeId"
                            placeholder="ì˜ˆ: 1768171911"
                            onkeypress="if(event.key==='Enter') collectSingle()"
                        >
                        <button class="button button-primary" onclick="collectSingle()">
                            ğŸ” ìˆ˜ì§‘í•˜ê¸°
                        </button>
                    </div>
                    <div class="help-text">
                        ğŸ’¡ í”Œë ˆì´ìŠ¤ IDëŠ” ë„¤ì´ë²„ ì§€ë„ URLì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤<br>
                        ì˜ˆ: https://map.naver.com/p/entry/place/<strong>1768171911</strong>
                    </div>
                </div>
            </div>
        </div>

        <div id="batch-tab" class="tab-content">
            <div class="input-section">
                <div class="form-group">
                    <label for="placeIdInput">í”Œë ˆì´ìŠ¤ ID ì…ë ¥</label>
                    <div class="input-wrapper">
                        <input
                            type="text"
                            id="placeIdInput"
                            placeholder="ID ì…ë ¥ í›„ Enter"
                            onkeypress="if(event.key==='Enter') addPlaceId()"
                        >
                        <button class="button button-secondary" onclick="addPlaceId()">
                            â• ì¶”ê°€
                        </button>
                    </div>
                </div>

                <div class="form-group">
                    <label>ë˜ëŠ” ì—¬ëŸ¬ ê°œ í•œ ë²ˆì— ì…ë ¥ (ì¤„ë°”ê¿ˆìœ¼ë¡œ êµ¬ë¶„)</label>
                    <textarea
                        id="bulkInput"
                        placeholder="1768171911&#10;1234567890&#10;0987654321"
                    ></textarea>
                    <button class="button button-secondary" onclick="addBulkIds()" style="margin-top: 10px;">
                        ğŸ“ ì¼ê´„ ì¶”ê°€
                    </button>
                </div>

                <div class="form-group" id="idListContainer" style="display: none;">
                    <label>ìˆ˜ì§‘ ëª©ë¡ (<span id="idCount">0</span>ê°œ)</label>
                    <div class="id-list" id="idList"></div>
                </div>

                <div class="actions">
                    <button class="button button-primary" onclick="collectBatch()" id="collectBtn">
                        ğŸš€ ì „ì²´ ìˆ˜ì§‘ ì‹œì‘
                    </button>
                    <button class="button button-secondary" onclick="clearIds()">
                        ğŸ—‘ï¸ ëª©ë¡ ì§€ìš°ê¸°
                    </button>
                </div>
            </div>
        </div>

        <div class="status" id="status">
            <div class="status-header">
                <div class="spinner" id="spinner"></div>
                <h3 id="statusTitle">ìˆ˜ì§‘ ì¤‘...</h3>
            </div>
            <div class="log" id="log"></div>
        </div>

        <div id="l1-tab" class="tab-content">
            <div class="input-section">
                <h3 style="margin-bottom: 20px;">ğŸ“Š L1 ë°ì´í„° ìˆ˜ì§‘ ë° ì •ë ¬</h3>
                <p style="color: #666; margin-bottom: 20px; line-height: 1.6;">
                    í¬ë¡¤ëŸ¬ë¡œ ìˆ˜ì§‘í•œ ë°ì´í„°ë¥¼ ë¶„ì„ ê°€ëŠ¥í•œ í˜•íƒœë¡œ ì •ë ¬í•˜ê³ , í‚¤ì›Œë“œ ì¶”ì¶œ ìš”ì†Œë¥¼ ì²´ê³„ì ìœ¼ë¡œ ë¶„ë¥˜í•©ë‹ˆë‹¤.
                </p>

                <div class="form-group">
                    <label>ì²˜ë¦¬ ë‹¨ê³„</label>
                    <ul style="color: #666; font-size: 14px; line-height: 1.8; padding-left: 20px;">
                        <li>ë°ì´í„° ì†ŒìŠ¤ ìŠ¤ìº” ë° ê²€ì¦</li>
                        <li>í¬ë¡¤ëŸ¬ JSON íŒŒì¼ ë¡œë”©</li>
                        <li>ì£¼ì†Œ íŒŒì‹± ë° ì§€ì—­ ì •ë³´ ì¶”ì¶œ</li>
                        <li>í‚¤ì›Œë“œ ìš”ì†Œ ë¶„ë¥˜ (ì¹´í…Œê³ ë¦¬, ì§€ì—­, ë©”ë‰´, ì†ì„±)</li>
                        <li>ë°ì´í„° ì™„ì„±ë„ í‰ê°€</li>
                        <li>ìš°ì„ ìˆœìœ„ ì •ë ¬ ë° JSON ì €ì¥</li>
                    </ul>
                </div>

                <div class="actions">
                    <button class="button button-primary" onclick="startL1Process()" id="l1Btn">
                        ğŸš€ L1 ì²˜ë¦¬ ì‹œì‘
                    </button>
                </div>

                <div id="l1Results" style="display: none; margin-top: 30px;">
                    <h4 style="margin-bottom: 15px;">ì²˜ë¦¬ ê²°ê³¼</h4>
                    <div id="l1Summary" style="background: #f8f9fa; padding: 20px; border-radius: 10px;"></div>
                </div>
            </div>
        </div>

        <div id="logs-tab" class="tab-content">
            <div class="input-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3>ğŸ” ë””ë²„ê·¸ ë¡œê·¸</h3>
                    <div style="display: flex; gap: 10px;">
                        <button class="button button-secondary" onclick="pauseLogStream()" id="pauseBtn">
                            â¸ï¸ ì¼ì‹œì •ì§€
                        </button>
                        <button class="button button-secondary" onclick="clearLogs()">
                            ğŸ—‘ï¸ ë¡œê·¸ ì§€ìš°ê¸°
                        </button>
                    </div>
                </div>

                <div style="margin-bottom: 15px; display: flex; gap: 10px;">
                    <label style="display: flex; align-items: center; gap: 5px;">
                        <input type="checkbox" id="filterDebug" checked onchange="updateLogFilter()">
                        <span style="font-size: 14px;">ğŸ” Debug</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 5px;">
                        <input type="checkbox" id="filterInfo" checked onchange="updateLogFilter()">
                        <span style="font-size: 14px;">â„¹ï¸ Info</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 5px;">
                        <input type="checkbox" id="filterWarn" checked onchange="updateLogFilter()">
                        <span style="font-size: 14px;">âš ï¸ Warn</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 5px;">
                        <input type="checkbox" id="filterError" checked onchange="updateLogFilter()">
                        <span style="font-size: 14px;">âŒ Error</span>
                    </label>
                </div>

                <div id="debugLog" class="log" style="height: 500px; max-height: 500px;"></div>
            </div>
        </div>

        <div class="results" id="results"></div>
    </div>

    <script>
        let placeIds = [];
        let currentResults = [];
        let logEventSource = null;
        let logPaused = false;
        let allLogs = [];
        let logFilters = {
            debug: true,
            info: true,
            warn: true,
            error: true
        };

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë¡œê·¸ ìŠ¤íŠ¸ë¦¬ë° ì‹œì‘
        window.addEventListener('load', () => {
            initLogStream();
        });

        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

            event.target.classList.add('active');
            document.getElementById(tab + '-tab').classList.add('active');

            // ë¡œê·¸ íƒ­ìœ¼ë¡œ ì „í™˜ ì‹œ ìë™ ìŠ¤í¬ë¡¤
            if (tab === 'logs') {
                setTimeout(() => {
                    const logDiv = document.getElementById('debugLog');
                    logDiv.scrollTop = logDiv.scrollHeight;
                }, 100);
            }
        }

        // ë¡œê·¸ ìŠ¤íŠ¸ë¦¬ë° ì´ˆê¸°í™”
        function initLogStream() {
            if (logEventSource) {
                logEventSource.close();
            }

            logEventSource = new EventSource('http://localhost:3000/logs/stream');

            logEventSource.onmessage = (event) => {
                if (logPaused) return;

                try {
                    const log = JSON.parse(event.data);
                    allLogs.push(log);

                    // ìµœëŒ€ 5000ê°œ ë¡œê·¸ ìœ ì§€
                    if (allLogs.length > 5000) {
                        allLogs.shift();
                    }

                    appendLogToUI(log);
                } catch (error) {
                    console.error('ë¡œê·¸ íŒŒì‹± ì˜¤ë¥˜:', error);
                }
            };

            logEventSource.onerror = (error) => {
                console.error('ë¡œê·¸ ìŠ¤íŠ¸ë¦¬ë° ì˜¤ë¥˜:', error);
            };
        }

        // UIì— ë¡œê·¸ ì¶”ê°€
        function appendLogToUI(log) {
            if (!logFilters[log.level]) {
                return;
            }

            const logDiv = document.getElementById('debugLog');
            const timestamp = new Date(log.timestamp).toLocaleTimeString('ko-KR');

            const icons = {
                debug: 'ğŸ”',
                info: 'â„¹ï¸',
                warn: 'âš ï¸',
                error: 'âŒ'
            };

            const colors = {
                debug: '#6b7280',
                info: '#10b981',
                warn: '#f59e0b',
                error: '#ef4444'
            };

            const icon = icons[log.level] || '';
            const color = colors[log.level] || '#e2e8f0';

            let logText = `<span style="color: ${color}">${icon} [${timestamp}] ${log.message}</span>`;

            if (log.data) {
                logText += `\n<span style="color: #94a3b8">${JSON.stringify(log.data, null, 2)}</span>`;
            }

            logDiv.innerHTML += logText + '\n';

            // ìë™ ìŠ¤í¬ë¡¤ (í•˜ë‹¨ì— ìˆì„ ë•Œë§Œ)
            if (logDiv.scrollHeight - logDiv.scrollTop - logDiv.clientHeight < 100) {
                logDiv.scrollTop = logDiv.scrollHeight;
            }
        }

        // ë¡œê·¸ í•„í„° ì—…ë°ì´íŠ¸
        function updateLogFilter() {
            logFilters.debug = document.getElementById('filterDebug').checked;
            logFilters.info = document.getElementById('filterInfo').checked;
            logFilters.warn = document.getElementById('filterWarn').checked;
            logFilters.error = document.getElementById('filterError').checked;

            // ë¡œê·¸ ë‹¤ì‹œ ë Œë”ë§
            const logDiv = document.getElementById('debugLog');
            logDiv.innerHTML = '';

            allLogs.forEach(log => {
                appendLogToUI(log);
            });
        }

        // ë¡œê·¸ ìŠ¤íŠ¸ë¦¼ ì¼ì‹œì •ì§€/ì¬ê°œ
        function pauseLogStream() {
            const pauseBtn = document.getElementById('pauseBtn');
            logPaused = !logPaused;

            if (logPaused) {
                pauseBtn.innerHTML = 'â–¶ï¸ ì¬ê°œ';
            } else {
                pauseBtn.innerHTML = 'â¸ï¸ ì¼ì‹œì •ì§€';
            }
        }

        // ë¡œê·¸ ì§€ìš°ê¸°
        async function clearLogs() {
            if (!confirm('ëª¨ë“  ë¡œê·¸ë¥¼ ì§€ìš°ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }

            try {
                await fetch('http://localhost:3000/logs/clear', { method: 'POST' });
                allLogs = [];
                document.getElementById('debugLog').innerHTML = '';
            } catch (error) {
                alert('ë¡œê·¸ ì§€ìš°ê¸° ì‹¤íŒ¨: ' + error.message);
            }
        }

        // L1 ì²˜ë¦¬ ì‹œì‘
        async function startL1Process() {
            const btn = document.getElementById('l1Btn');
            btn.disabled = true;
            btn.innerHTML = 'â³ ì²˜ë¦¬ ì¤‘...';

            // ë¡œê·¸ íƒ­ìœ¼ë¡œ ìë™ ì „í™˜
            const logTab = Array.from(document.querySelectorAll('.tab')).find(t => t.textContent.includes('ë””ë²„ê·¸'));
            if (logTab) {
                logTab.click();
            }

            try {
                const response = await fetch('http://localhost:3000/l1/process');
                const result = await response.json();

                if (result.success) {
                    // ê²°ê³¼ í‘œì‹œ
                    showL1Results(result);
                    alert('L1 ì²˜ë¦¬ ì™„ë£Œ!');
                } else {
                    alert('L1 ì²˜ë¦¬ ì‹¤íŒ¨: ' + result.error);
                }
            } catch (error) {
                alert('L1 ì²˜ë¦¬ ì˜¤ë¥˜: ' + error.message);
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'ğŸš€ L1 ì²˜ë¦¬ ì‹œì‘';
            }
        }

        // L1 ê²°ê³¼ í‘œì‹œ
        function showL1Results(result) {
            const resultsDiv = document.getElementById('l1Results');
            const summaryDiv = document.getElementById('l1Summary');

            const summary = result.summary;
            const stats = summary.completeness_stats;

            summaryDiv.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div>
                        <div style="font-weight: 600; margin-bottom: 5px;">ì´ ë§¤ì¥ ìˆ˜</div>
                        <div style="font-size: 24px; color: #667eea;">${summary.total}ê°œ</div>
                    </div>
                    <div>
                        <div style="font-weight: 600; margin-bottom: 5px;">í˜„ì¬ í‚¤ì›Œë“œ ë³´ìœ </div>
                        <div style="font-size: 24px; color: #10b981;">${summary.with_current_keywords}ê°œ</div>
                    </div>
                    <div>
                        <div style="font-weight: 600; margin-bottom: 5px;">í‰ê·  ì™„ì„±ë„</div>
                        <div style="font-size: 24px; color: #f59e0b;">${summary.avg_completeness.toFixed(1)}ì </div>
                    </div>
                    <div>
                        <div style="font-weight: 600; margin-bottom: 5px;">ì²˜ë¦¬ ì‹œê°„</div>
                        <div style="font-size: 24px; color: #6b7280;">${summary.elapsed_time}ì´ˆ</div>
                    </div>
                </div>
                <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #e0e0e0;">
                    <div style="font-weight: 600; margin-bottom: 10px;">ë°ì´í„° ì™„ì„±ë„ ë¶„í¬</div>
                    <div style="display: flex; gap: 15px;">
                        <div style="flex: 1; background: #10b981; color: white; padding: 10px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 18px; font-weight: 600;">HIGH</div>
                            <div>${stats.HIGH}ê°œ</div>
                        </div>
                        <div style="flex: 1; background: #f59e0b; color: white; padding: 10px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 18px; font-weight: 600;">MEDIUM</div>
                            <div>${stats.MEDIUM}ê°œ</div>
                        </div>
                        <div style="flex: 1; background: #ef4444; color: white; padding: 10px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 18px; font-weight: 600;">LOW</div>
                            <div>${stats.LOW}ê°œ</div>
                        </div>
                    </div>
                </div>
                <div style="margin-top: 20px; text-align: center;">
                    <a href="#" onclick="viewL1Details(); return false;" class="example-link">
                        ğŸ“„ ìƒì„¸ ê²°ê³¼ ë³´ê¸° â†’
                    </a>
                </div>
            `;

            resultsDiv.style.display = 'block';
        }

        // L1 ìƒì„¸ ê²°ê³¼ ë³´ê¸°
        async function viewL1Details() {
            try {
                const response = await fetch('http://localhost:3000/l1/results');
                const result = await response.json();

                if (result.success) {
                    // ìƒˆ ì°½ìœ¼ë¡œ JSON í‘œì‹œ
                    const win = window.open('', '_blank');
                    win.document.write('<pre>' + JSON.stringify(result.data, null, 2) + '</pre>');
                } else {
                    alert('ê²°ê³¼ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                alert('ê²°ê³¼ ì¡°íšŒ ì˜¤ë¥˜: ' + error.message);
            }
        }

        function addPlaceId() {
            const input = document.getElementById('placeIdInput');
            const id = input.value.trim();

            if (!id) return;

            if (!/^\d+$/.test(id)) {
                alert('í”Œë ˆì´ìŠ¤ IDëŠ” ìˆ«ìë§Œ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                return;
            }

            if (placeIds.includes(id)) {
                alert('ì´ë¯¸ ì¶”ê°€ëœ IDì…ë‹ˆë‹¤.');
                return;
            }

            placeIds.push(id);
            updateIdList();
            input.value = '';
        }

        function addBulkIds() {
            const textarea = document.getElementById('bulkInput');
            const lines = textarea.value.split('\n');

            let added = 0;
            lines.forEach(line => {
                const id = line.trim();
                if (id && /^\d+$/.test(id) && !placeIds.includes(id)) {
                    placeIds.push(id);
                    added++;
                }
            });

            if (added > 0) {
                updateIdList();
                textarea.value = '';
                alert(`${added}ê°œì˜ IDê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`);
            }
        }

        function removeId(id) {
            placeIds = placeIds.filter(pid => pid !== id);
            updateIdList();
        }

        function updateIdList() {
            const container = document.getElementById('idListContainer');
            const list = document.getElementById('idList');
            const count = document.getElementById('idCount');

            if (placeIds.length === 0) {
                container.style.display = 'none';
                return;
            }

            container.style.display = 'block';
            count.textContent = placeIds.length;

            list.innerHTML = placeIds.map(id => `
                <div class="id-chip">
                    ${id}
                    <button onclick="removeId('${id}')">Ã—</button>
                </div>
            `).join('');
        }

        function clearIds() {
            if (placeIds.length === 0) return;
            if (confirm(`${placeIds.length}ê°œì˜ IDë¥¼ ëª¨ë‘ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                placeIds = [];
                updateIdList();
            }
        }

        function showStatus(title) {
            const status = document.getElementById('status');
            const statusTitle = document.getElementById('statusTitle');
            const spinner = document.getElementById('spinner');

            status.classList.add('active');
            statusTitle.textContent = title;
            spinner.style.display = 'block';
        }

        function hideStatus() {
            const spinner = document.getElementById('spinner');
            spinner.style.display = 'none';
        }

        function addLog(message) {
            const log = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString('ko-KR');
            log.textContent += `[${timestamp}] ${message}\n`;
            log.scrollTop = log.scrollHeight;
        }

        function displayResult(data) {
            const results = document.getElementById('results');

            const card = document.createElement('div');
            card.className = 'result-card';
            card.innerHTML = `
                <div class="result-header">
                    <div>
                        <div class="result-title">${data.name}</div>
                        <div style="color: #666; margin-top: 5px;">${data.category}</div>
                    </div>
                    <div class="result-badge">âœ“ ìˆ˜ì§‘ì™„ë£Œ</div>
                </div>
                <div class="result-info">
                    <div class="info-item">
                        <span class="info-label">ğŸ“</span>
                        <span>${data.roadAddress || data.address}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">ğŸ“</span>
                        <span>${data.phone}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">â­</span>
                        <span>${data.rating} (ë¦¬ë·° ${data.reviewCount}ê°œ)</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">ğŸ´</span>
                        <span>ë©”ë‰´ ${data.menus.length}ê°œ</span>
                    </div>
                </div>
                <div style="margin-top: 15px;">
                    <a href="${data.url}" target="_blank" class="example-link">
                        ë„¤ì´ë²„ í”Œë ˆì´ìŠ¤ì—ì„œ ë³´ê¸° â†’
                    </a>
                </div>
            `;

            results.insertBefore(card, results.firstChild);
        }

        async function collectSingle() {
            const id = document.getElementById('placeId').value.trim();

            if (!id) {
                alert('í”Œë ˆì´ìŠ¤ IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            if (!/^\d+$/.test(id)) {
                alert('í”Œë ˆì´ìŠ¤ IDëŠ” ìˆ«ìë§Œ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                return;
            }

            showStatus('ìˆ˜ì§‘ ì¤‘...');
            document.getElementById('log').textContent = '';
            addLog(`í”Œë ˆì´ìŠ¤ ID ${id} ìˆ˜ì§‘ ì‹œì‘`);

            try {
                addLog('ì„œë²„ì— ìš”ì²­ ì¤‘...');
                const response = await fetch(`http://localhost:3000/scrape/${id}`);
                const result = await response.json();

                if (result.success) {
                    addLog('âœ“ ìˆ˜ì§‘ ì™„ë£Œ!');
                    addLog(`íŒŒì¼ ì €ì¥: ${result.filename}`);
                    hideStatus();
                    displayResult(result.data);
                } else {
                    addLog(`âœ— ì˜¤ë¥˜: ${result.error}`);
                }
            } catch (error) {
                addLog(`âœ— ì˜¤ë¥˜: ${error.message}`);
                addLog('ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.');
            }
        }

        async function collectBatch() {
            if (placeIds.length === 0) {
                alert('ìˆ˜ì§‘í•  í”Œë ˆì´ìŠ¤ IDë¥¼ ì¶”ê°€í•´ì£¼ì„¸ìš”.');
                return;
            }

            showStatus(`ë°°ì¹˜ ìˆ˜ì§‘ ì¤‘... (0/${placeIds.length})`);
            document.getElementById('log').textContent = '';
            document.getElementById('collectBtn').disabled = true;

            for (let i = 0; i < placeIds.length; i++) {
                const id = placeIds[i];
                document.getElementById('statusTitle').textContent =
                    `ë°°ì¹˜ ìˆ˜ì§‘ ì¤‘... (${i + 1}/${placeIds.length})`;

                addLog(`\n[${i + 1}/${placeIds.length}] ${id} ìˆ˜ì§‘ ì‹œì‘`);

                try {
                    const response = await fetch(`http://localhost:3000/scrape/${id}`);
                    const result = await response.json();

                    if (result.success) {
                        addLog(`âœ“ ${result.data.name} ìˆ˜ì§‘ ì™„ë£Œ`);
                        displayResult(result.data);
                    } else {
                        addLog(`âœ— ì‹¤íŒ¨: ${result.error}`);
                    }
                } catch (error) {
                    addLog(`âœ— ì˜¤ë¥˜: ${error.message}`);
                }

                // ë‹¤ìŒ ìš”ì²­ ì „ ëŒ€ê¸°
                if (i < placeIds.length - 1) {
                    addLog('5ì´ˆ ëŒ€ê¸° ì¤‘...');
                    await new Promise(resolve => setTimeout(resolve, 5000));
                }
            }

            hideStatus();
            document.getElementById('statusTitle').textContent = 'âœ“ ì „ì²´ ìˆ˜ì§‘ ì™„ë£Œ!';
            addLog('\nâœ“ ëª¨ë“  ìˆ˜ì§‘ ì™„ë£Œ!');
            document.getElementById('collectBtn').disabled = false;
        }
    </script>
</body>
</html>
